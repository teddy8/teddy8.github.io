---
layout: post   
title:  " Node.js api 작성 "
categories: Node.js
comments: true
tags: Node.js api 작성 http get post
author: teddy8  
---
* content
{:toc}

```
Node.js에서 api를 작성하는 방법을 예제를 통해 정리한다.
api는 기본적으로 요청/응답한다.
다음은 GET 메소드를 통한 요청/응답하는 예제이다.
```

## 소스코드

example.js

``` js
"use strict";

const http = require('http');
const url = require('url'); // url문자열 or 객체값을 쉽게 가져올 수 있음

const hostname = '127.0.0.1';
const port = 3000;

const server = http.createServer((req, res) => {  
  switch (req.method) { // A   
    case 'GET':
      if (req.url === '/') { // B   경로에 /만 포함하는 요청인 경우
        res.setHeader('Content-Type', 'text/plain');
        res.writeHead(200);
        res.end('Hello! Node.js HTTP Server');
      } else if (req.url.substring(0, 5) === '/data') { // C    경로에 /data를 포함하는 요청인 경우
        const queryParams = url.parse(req.url, true).query;

        res.setHeader('Content-Type', 'text/html');
        res.writeHead(200);
        res.write('<html><head><title>JavaScript 200제</title></head>');

        for (let key in queryParams) {  // queryParams: {qs1: '1', qs2: '2'} 이런식인데 
          res.write(`<h1>${key}</h1>`); // key와
          res.write(`<h2>${queryParams[key]}</h2>`); // 그 key의 value 출력
        }

        res.end('</body></html>');  // write로 헤더정보 및 html코드 연달아 보내다가 end로 마무리
      }
      break;
    default:  // case에 없는 경우 바로 완료 처리
      res.end();
  }

});

server.listen(port, hostname, () => { // http 서버 실행해서 연결 수신받기
  console.log(`ㅎ2 Server running at http://${hostname}:${port}/`);
});
```

## 설명

```
위에 주석친 부분을 문단단위로 정리한다.

http의 createServer()메소드를 통해 서버를 생성한다.
req의 method를 통해 4가지중 어떤 동작을 하는지 파악할 수 있다.(GET, POST, PUT, DELETE) 
case 'GET'을 작성해 GET으로 요청한 경우를 처리해준다.
req의 url을 통해 요청한 경로가 '/'를 포함하는 요청인 경우
(http://127.0.0.1:3000/ 이런식인 경우)
기본적인 헤더값과 상태요청코드, res.end()를 통해 'Hello! Node.js HTTP Server'문구를 전달한다
req의 url을 통해 요청한 경로가 '/data'를 포함하는 요청인 경우
(http://127.0.0.1:3000/data?qs1=2&qs2=3 이런식인 경우)
url의 parse()메소드를 통해 url의 문자열값을 객체값으로 파싱한다.






[A] fs.open()메소드를 통해 해당 경로의 파일을 'r'모드로 open한다.
(읽을 수 없거나 기타 에러시 에러정보를 출력한다)

[B] fs의 readFile()메소드를 통해 파일을 읽어온다.
[fs.readFile(파일경로, 인코딩, 콜백함수)]
그 후, 파일정보를 출력한다.
이 방식은 비동기 패턴이다.

[C] fs의 readFileSync()메소드를 통해 반환된 파일정보를 출력한다.
[fs.readFileSync()메소드  파일경로, 인코딩]
Sync가 붙은 이유는 동기패턴이기 때문이다. 
동기 패턴은 에러에 대한 값이 반환되는 것은 아니기 때문에 
try-catch문을 통해 에러를 catch해야 한다.
그렇지 않고 동기 패턴에서 에러가 발생하면 idle상태에 빠져서 작동하지 않게 된다.
```